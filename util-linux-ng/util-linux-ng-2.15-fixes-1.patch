Submitted by:            Matt Burgess <matthew at linuxfromscratch dot org>
Date:                    2009-05-17
Initial Package Version: 2.15
Upstream Status:         From upstream
Origin:                  Upstream
Description:             Fixes several configure and compile issues relating to
                         libuuid (commit cdd17c7), blkid (commit 7c950ef), and
                         make -C (commit 2ef7d41).

diff -Naur util-linux-ng-2.15.orig/Makefile.in util-linux-ng-2.15/Makefile.in
--- util-linux-ng-2.15.orig/Makefile.in	2009-05-05 21:21:36.000000000 +0000
+++ util-linux-ng-2.15/Makefile.in	2009-05-17 17:52:02.000000000 +0000
@@ -53,8 +53,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \
@@ -249,6 +249,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 SUBDIRS = include disk-utils fdisk getopt lib libs login-utils \
 	misc-utils po schedutils sys-utils text-utils tests \
diff -Naur util-linux-ng-2.15.orig/aclocal.m4 util-linux-ng-2.15/aclocal.m4
--- util-linux-ng-2.15.orig/aclocal.m4	2009-05-05 21:21:30.000000000 +0000
+++ util-linux-ng-2.15/aclocal.m4	2009-05-17 17:51:55.000000000 +0000
@@ -19,162 +19,6 @@
 If you have problems, you may need to regenerate the build system entirely.
 To do so, use the procedure documented by the package, typically `autoreconf'.])])
 
-# pkg.m4 - Macros to locate and utilise pkg-config.            -*- Autoconf -*-
-# 
-# Copyright Â© 2004 Scott James Remnant <scott@netsplit.com>.
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful, but
-# WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-# General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-#
-# As a special exception to the GNU General Public License, if you
-# distribute this file as part of a program that contains a
-# configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
-
-# PKG_PROG_PKG_CONFIG([MIN-VERSION])
-# ----------------------------------
-AC_DEFUN([PKG_PROG_PKG_CONFIG],
-[m4_pattern_forbid([^_?PKG_[A-Z_]+$])
-m4_pattern_allow([^PKG_CONFIG(_PATH)?$])
-AC_ARG_VAR([PKG_CONFIG], [path to pkg-config utility])dnl
-if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
-	AC_PATH_TOOL([PKG_CONFIG], [pkg-config])
-fi
-if test -n "$PKG_CONFIG"; then
-	_pkg_min_version=m4_default([$1], [0.9.0])
-	AC_MSG_CHECKING([pkg-config is at least version $_pkg_min_version])
-	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
-		AC_MSG_RESULT([yes])
-	else
-		AC_MSG_RESULT([no])
-		PKG_CONFIG=""
-	fi
-		
-fi[]dnl
-])# PKG_PROG_PKG_CONFIG
-
-# PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
-#
-# Check to see whether a particular set of modules exists.  Similar
-# to PKG_CHECK_MODULES(), but does not set variables or print errors.
-#
-#
-# Similar to PKG_CHECK_MODULES, make sure that the first instance of
-# this or PKG_CHECK_MODULES is called, or make sure to call
-# PKG_CHECK_EXISTS manually
-# --------------------------------------------------------------
-AC_DEFUN([PKG_CHECK_EXISTS],
-[AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
-if test -n "$PKG_CONFIG" && \
-    AC_RUN_LOG([$PKG_CONFIG --exists --print-errors "$1"]); then
-  m4_ifval([$2], [$2], [:])
-m4_ifvaln([$3], [else
-  $3])dnl
-fi])
-
-
-# _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
-# ---------------------------------------------
-m4_define([_PKG_CONFIG],
-[if test -n "$$1"; then
-    pkg_cv_[]$1="$$1"
- elif test -n "$PKG_CONFIG"; then
-    PKG_CHECK_EXISTS([$3],
-                     [pkg_cv_[]$1=`$PKG_CONFIG --[]$2 "$3" 2>/dev/null`],
-		     [pkg_failed=yes])
- else
-    pkg_failed=untried
-fi[]dnl
-])# _PKG_CONFIG
-
-# _PKG_SHORT_ERRORS_SUPPORTED
-# -----------------------------
-AC_DEFUN([_PKG_SHORT_ERRORS_SUPPORTED],
-[AC_REQUIRE([PKG_PROG_PKG_CONFIG])
-if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
-        _pkg_short_errors_supported=yes
-else
-        _pkg_short_errors_supported=no
-fi[]dnl
-])# _PKG_SHORT_ERRORS_SUPPORTED
-
-
-# PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
-# [ACTION-IF-NOT-FOUND])
-#
-#
-# Note that if there is a possibility the first call to
-# PKG_CHECK_MODULES might not happen, you should be sure to include an
-# explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
-#
-#
-# --------------------------------------------------------------
-AC_DEFUN([PKG_CHECK_MODULES],
-[AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
-AC_ARG_VAR([$1][_CFLAGS], [C compiler flags for $1, overriding pkg-config])dnl
-AC_ARG_VAR([$1][_LIBS], [linker flags for $1, overriding pkg-config])dnl
-
-pkg_failed=no
-AC_MSG_CHECKING([for $1])
-
-_PKG_CONFIG([$1][_CFLAGS], [cflags], [$2])
-_PKG_CONFIG([$1][_LIBS], [libs], [$2])
-
-m4_define([_PKG_TEXT], [Alternatively, you may set the environment variables $1[]_CFLAGS
-and $1[]_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.])
-
-if test $pkg_failed = yes; then
-        _PKG_SHORT_ERRORS_SUPPORTED
-        if test $_pkg_short_errors_supported = yes; then
-	        $1[]_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "$2" 2>&1`
-        else 
-	        $1[]_PKG_ERRORS=`$PKG_CONFIG --print-errors "$2" 2>&1`
-        fi
-	# Put the nasty error message in config.log where it belongs
-	echo "$$1[]_PKG_ERRORS" >&AS_MESSAGE_LOG_FD
-
-	ifelse([$4], , [AC_MSG_ERROR(dnl
-[Package requirements ($2) were not met:
-
-$$1_PKG_ERRORS
-
-Consider adjusting the PKG_CONFIG_PATH environment variable if you
-installed software in a non-standard prefix.
-
-_PKG_TEXT
-])],
-		[AC_MSG_RESULT([no])
-                $4])
-elif test $pkg_failed = untried; then
-	ifelse([$4], , [AC_MSG_FAILURE(dnl
-[The pkg-config script could not be found or is too old.  Make sure it
-is in your PATH or set the PKG_CONFIG environment variable to the full
-path to pkg-config.
-
-_PKG_TEXT
-
-To get pkg-config, see <http://pkg-config.freedesktop.org/>.])],
-		[$4])
-else
-	$1[]_CFLAGS=$pkg_cv_[]$1[]_CFLAGS
-	$1[]_LIBS=$pkg_cv_[]$1[]_LIBS
-        AC_MSG_RESULT([yes])
-	ifelse([$3], , :, [$3])
-fi[]dnl
-])# PKG_CHECK_MODULES
-
 # Copyright (C) 2002, 2003, 2005, 2006, 2007  Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
@@ -1033,5 +877,6 @@
 m4_include([m4/ltversion.m4])
 m4_include([m4/lt~obsolete.m4])
 m4_include([m4/nls.m4])
+m4_include([m4/pkg.m4])
 m4_include([m4/po.m4])
 m4_include([m4/progtest.m4])
diff -Naur util-linux-ng-2.15.orig/config/include-Makefile.am util-linux-ng-2.15/config/include-Makefile.am
--- util-linux-ng-2.15.orig/config/include-Makefile.am	2009-03-25 12:20:16.000000000 +0000
+++ util-linux-ng-2.15/config/include-Makefile.am	2009-05-17 17:51:39.000000000 +0000
@@ -17,6 +17,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 
 $(ul_libblkid_la):
diff -Naur util-linux-ng-2.15.orig/config.h.in util-linux-ng-2.15/config.h.in
--- util-linux-ng-2.15.orig/config.h.in	2009-05-05 21:26:40.000000000 +0000
+++ util-linux-ng-2.15/config.h.in	2009-05-17 17:51:58.000000000 +0000
@@ -7,9 +7,15 @@
    language is requested. */
 #undef ENABLE_NLS
 
+/* Define to 1 if you have the <blkid/blkid.h> header file. */
+#undef HAVE_BLKID_BLKID_H
+
 /* Define to 1 if you have the blkid_evaluate_tag(). */
 #undef HAVE_BLKID_EVALUATE_TAG
 
+/* Define to 1 if you have the <blkid.h> header file. */
+#undef HAVE_BLKID_H
+
 /* Define if the GNU dcgettext() function is already present or preinstalled.
    */
 #undef HAVE_DCGETTEXT
diff -Naur util-linux-ng-2.15.orig/configure util-linux-ng-2.15/configure
--- util-linux-ng-2.15.orig/configure	2009-05-05 21:21:32.000000000 +0000
+++ util-linux-ng-2.15/configure	2009-05-17 17:51:57.000000000 +0000
@@ -13986,10 +13986,11 @@
 { $as_echo "$as_me:$LINENO: checking for BLKID" >&5
 $as_echo_n "checking for BLKID... " >&6; }
 
-if test -n "$BLKID_CFLAGS"; then
-    pkg_cv_BLKID_CFLAGS="$BLKID_CFLAGS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
+if test -n "$PKG_CONFIG"; then
+    if test -n "$BLKID_CFLAGS"; then
+        pkg_cv_BLKID_CFLAGS="$BLKID_CFLAGS"
+    else
+        if test -n "$PKG_CONFIG" && \
     { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"blkid\"") >&5
   ($PKG_CONFIG --exists --print-errors "blkid") 2>&5
   ac_status=$?
@@ -13999,13 +14000,15 @@
 else
   pkg_failed=yes
 fi
- else
-    pkg_failed=untried
+    fi
+else
+	pkg_failed=untried
 fi
-if test -n "$BLKID_LIBS"; then
-    pkg_cv_BLKID_LIBS="$BLKID_LIBS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
+if test -n "$PKG_CONFIG"; then
+    if test -n "$BLKID_LIBS"; then
+        pkg_cv_BLKID_LIBS="$BLKID_LIBS"
+    else
+        if test -n "$PKG_CONFIG" && \
     { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"blkid\"") >&5
   ($PKG_CONFIG --exists --print-errors "blkid") 2>&5
   ac_status=$?
@@ -14015,8 +14018,9 @@
 else
   pkg_failed=yes
 fi
- else
-    pkg_failed=untried
+    fi
+else
+	pkg_failed=untried
 fi
 
 
@@ -14029,9 +14033,9 @@
         _pkg_short_errors_supported=no
 fi
         if test $_pkg_short_errors_supported = yes; then
-	        BLKID_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "blkid" 2>&1`
+	        BLKID_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "blkid"`
         else
-	        BLKID_PKG_ERRORS=`$PKG_CONFIG --print-errors "blkid" 2>&1`
+	        BLKID_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "blkid"`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$BLKID_PKG_ERRORS" >&5
@@ -14090,19 +14094,192 @@
 $as_echo "yes" >&6; }
 	have_blkid=yes
 fi
-  { $as_echo "$as_me:$LINENO: checking for blkid_evaluate_tag in -lblkid" >&5
-$as_echo_n "checking for blkid_evaluate_tag in -lblkid... " >&6; }
-if test "${ac_cv_lib_blkid_blkid_evaluate_tag+set}" = set; then
+  if test "x$have_blkid" = xyes; then
+    old_CFLAGS="$CFLAGS"
+    old_CPPFLAGS="$CPPFLAGS"
+    old_LDFLAGS="$LDFLAGS"
+    CFLAGS="$CFLAGS $BLKID_CFLAGS"
+    CPPFLAGS="$CPPFLAGS $BLKID_CFLAGS"
+    LDFLAGS="$LDFLAGS $BLKID_LIBS"
+
+
+for ac_header in blkid.h blkid/blkid.h
+do
+as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
+$as_echo_n "checking for $ac_header... " >&6; }
+if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
   $as_echo_n "(cached) " >&6
+fi
+ac_res=`eval 'as_val=${'$as_ac_Header'}
+		 $as_echo "$as_val"'`
+	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lblkid  $LIBS"
+  # Is the header compilable?
+{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
+$as_echo_n "checking $ac_header usability... " >&6; }
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
+$ac_includes_default
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
+$as_echo "$ac_try_echo") >&5
+  (eval "$ac_compile") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then
+  ac_header_compiler=yes
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_header_compiler=no
+fi
+
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
+$as_echo_n "checking $ac_header presence... " >&6; }
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <$ac_header>
+_ACEOF
+if { (ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
+$as_echo "$ac_try_echo") >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then
+  ac_header_preproc=yes
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+
+rm -f conftest.err conftest.$ac_ext
+{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
+$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
+    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
+$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
+    ( cat <<\_ASBOX
+## ------------------------------ ##
+## Report this to kzak@redhat.com ##
+## ------------------------------ ##
+_ASBOX
+     ) | sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
+$as_echo_n "checking for $ac_header... " >&6; }
+if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+  $as_echo_n "(cached) " >&6
+else
+  eval "$as_ac_Header=\$ac_header_preproc"
+fi
+ac_res=`eval 'as_val=${'$as_ac_Header'}
+		 $as_echo "$as_val"'`
+	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+
+fi
+as_val=`eval 'as_val=${'$as_ac_Header'}
+		 $as_echo "$as_val"'`
+   if test "x$as_val" = x""yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+ break
+fi
+
+done
+
+    { $as_echo "$as_me:$LINENO: checking for blkid_evaluate_tag" >&5
+$as_echo_n "checking for blkid_evaluate_tag... " >&6; }
+if test "${ac_cv_func_blkid_evaluate_tag+set}" = set; then
+  $as_echo_n "(cached) " >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+/* Define blkid_evaluate_tag to an innocuous variant, in case <limits.h> declares blkid_evaluate_tag.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define blkid_evaluate_tag innocuous_blkid_evaluate_tag
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char blkid_evaluate_tag (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef blkid_evaluate_tag
 
 /* Override any GCC internal prototype to avoid an error.
    Use char because int might match the return type of a GCC
@@ -14111,6 +14288,13 @@
 extern "C"
 #endif
 char blkid_evaluate_tag ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_blkid_evaluate_tag || defined __stub___blkid_evaluate_tag
+choke me
+#endif
+
 int
 main ()
 {
@@ -14140,35 +14324,39 @@
 	 test "$cross_compiling" = yes ||
 	 $as_test_x conftest$ac_exeext
        }; then
-  ac_cv_lib_blkid_blkid_evaluate_tag=yes
+  ac_cv_func_blkid_evaluate_tag=yes
 else
   $as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_lib_blkid_blkid_evaluate_tag=no
+	ac_cv_func_blkid_evaluate_tag=no
 fi
 
 rm -rf conftest.dSYM
 rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
       conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_blkid_blkid_evaluate_tag" >&5
-$as_echo "$ac_cv_lib_blkid_blkid_evaluate_tag" >&6; }
-if test "x$ac_cv_lib_blkid_blkid_evaluate_tag" = x""yes; then
+{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_blkid_evaluate_tag" >&5
+$as_echo "$ac_cv_func_blkid_evaluate_tag" >&6; }
+if test "x$ac_cv_func_blkid_evaluate_tag" = x""yes; then
   have_blkid_evaluate=yes
 fi
 
+    CFLAGS="$old_CFLAGS"
+    CPPFLAGS="$old_CPPFLAGS"
+    LDFLAGS="$old_LDFLAGS"
+  fi
 elif test "x$with_fsprobe" = xvolume_id; then
 
 pkg_failed=no
 { $as_echo "$as_me:$LINENO: checking for VOLUME_ID" >&5
 $as_echo_n "checking for VOLUME_ID... " >&6; }
 
-if test -n "$VOLUME_ID_CFLAGS"; then
-    pkg_cv_VOLUME_ID_CFLAGS="$VOLUME_ID_CFLAGS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
+if test -n "$PKG_CONFIG"; then
+    if test -n "$VOLUME_ID_CFLAGS"; then
+        pkg_cv_VOLUME_ID_CFLAGS="$VOLUME_ID_CFLAGS"
+    else
+        if test -n "$PKG_CONFIG" && \
     { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"volume_id\"") >&5
   ($PKG_CONFIG --exists --print-errors "volume_id") 2>&5
   ac_status=$?
@@ -14178,13 +14366,15 @@
 else
   pkg_failed=yes
 fi
- else
-    pkg_failed=untried
+    fi
+else
+	pkg_failed=untried
 fi
-if test -n "$VOLUME_ID_LIBS"; then
-    pkg_cv_VOLUME_ID_LIBS="$VOLUME_ID_LIBS"
- elif test -n "$PKG_CONFIG"; then
-    if test -n "$PKG_CONFIG" && \
+if test -n "$PKG_CONFIG"; then
+    if test -n "$VOLUME_ID_LIBS"; then
+        pkg_cv_VOLUME_ID_LIBS="$VOLUME_ID_LIBS"
+    else
+        if test -n "$PKG_CONFIG" && \
     { ($as_echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"volume_id\"") >&5
   ($PKG_CONFIG --exists --print-errors "volume_id") 2>&5
   ac_status=$?
@@ -14194,8 +14384,9 @@
 else
   pkg_failed=yes
 fi
- else
-    pkg_failed=untried
+    fi
+else
+	pkg_failed=untried
 fi
 
 
@@ -14208,9 +14399,9 @@
         _pkg_short_errors_supported=no
 fi
         if test $_pkg_short_errors_supported = yes; then
-	        VOLUME_ID_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "volume_id" 2>&1`
+	        VOLUME_ID_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "volume_id"`
         else
-	        VOLUME_ID_PKG_ERRORS=`$PKG_CONFIG --print-errors "volume_id" 2>&1`
+	        VOLUME_ID_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "volume_id"`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$VOLUME_ID_PKG_ERRORS" >&5
diff -Naur util-linux-ng-2.15.orig/configure.ac util-linux-ng-2.15/configure.ac
--- util-linux-ng-2.15.orig/configure.ac	2009-05-05 20:20:44.000000000 +0000
+++ util-linux-ng-2.15/configure.ac	2009-05-17 17:51:39.000000000 +0000
@@ -1,4 +1,4 @@
-AC_INIT(util-linux-ng, 2.15, kzak@redhat.com)
+		AC_INIT(util-linux-ng, 2.15, kzak@redhat.com)
 
 AC_PREREQ(2.60)
 
@@ -180,7 +180,19 @@
 
 if test "x$with_fsprobe" = xblkid; then
   PKG_CHECK_MODULES(BLKID, blkid, [have_blkid=yes], [])
-  AC_CHECK_LIB(blkid, blkid_evaluate_tag, [have_blkid_evaluate=yes], [])
+  if test "x$have_blkid" = xyes; then
+    old_CFLAGS="$CFLAGS"
+    old_CPPFLAGS="$CPPFLAGS"
+    old_LDFLAGS="$LDFLAGS"
+    CFLAGS="$CFLAGS $BLKID_CFLAGS"
+    CPPFLAGS="$CPPFLAGS $BLKID_CFLAGS"
+    LDFLAGS="$LDFLAGS $BLKID_LIBS"
+    AC_CHECK_HEADERS([blkid.h blkid/blkid.h], [break], [])
+    AC_CHECK_FUNC(blkid_evaluate_tag, [have_blkid_evaluate=yes], [])
+    CFLAGS="$old_CFLAGS"
+    CPPFLAGS="$old_CPPFLAGS"
+    LDFLAGS="$old_LDFLAGS"
+  fi
 elif test "x$with_fsprobe" = xvolume_id; then
   PKG_CHECK_MODULES(VOLUME_ID, volume_id, [have_volume_id=yes], [])
 elif test "x$with_fsprobe" = xbuiltin; then
diff -Naur util-linux-ng-2.15.orig/disk-utils/Makefile.in util-linux-ng-2.15/disk-utils/Makefile.in
--- util-linux-ng-2.15.orig/disk-utils/Makefile.in	2009-05-05 21:21:33.000000000 +0000
+++ util-linux-ng-2.15/disk-utils/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -60,8 +60,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -330,6 +330,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 utils_common = ../lib/blkdev.c $(am__append_1)
 dist_man_MANS = isosize.8 mkfs.8 mkswap.8 fsck.minix.8 mkfs.minix.8 \
diff -Naur util-linux-ng-2.15.orig/fdisk/Makefile.in util-linux-ng-2.15/fdisk/Makefile.in
--- util-linux-ng-2.15.orig/fdisk/Makefile.in	2009-05-05 21:21:33.000000000 +0000
+++ util-linux-ng-2.15/fdisk/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -56,8 +56,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -323,6 +323,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 EXTRA_DIST = README.fdisk README.cfdisk sfdisk.examples partitiontype.c
 fdisk_common = i386_sys_types.c common.h gpt.c gpt.h ../lib/blkdev.c \
diff -Naur util-linux-ng-2.15.orig/fsck/Makefile.in util-linux-ng-2.15/fsck/Makefile.in
--- util-linux-ng-2.15.orig/fsck/Makefile.in	2009-05-05 21:21:33.000000000 +0000
+++ util-linux-ng-2.15/fsck/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -51,8 +51,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -254,6 +254,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = fsck.8
 fsck_SOURCES = base_device.c fsck.c fsck.h ../lib/ismounted.c \
diff -Naur util-linux-ng-2.15.orig/getopt/Makefile.in util-linux-ng-2.15/getopt/Makefile.in
--- util-linux-ng-2.15.orig/getopt/Makefile.in	2009-05-05 21:21:33.000000000 +0000
+++ util-linux-ng-2.15/getopt/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -47,8 +47,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -243,6 +243,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = getopt.1
 exampledir = $(datadir)/getopt/
diff -Naur util-linux-ng-2.15.orig/hwclock/Makefile.in util-linux-ng-2.15/hwclock/Makefile.in
--- util-linux-ng-2.15.orig/hwclock/Makefile.in	2009-05-05 21:21:33.000000000 +0000
+++ util-linux-ng-2.15/hwclock/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -46,8 +46,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -241,6 +241,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = hwclock.8
 hwclock_SOURCES = hwclock.c cmos.c rtc.c kd.c clock.h
diff -Naur util-linux-ng-2.15.orig/include/Makefile.in util-linux-ng-2.15/include/Makefile.in
--- util-linux-ng-2.15.orig/include/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/include/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -44,8 +44,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -217,6 +217,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_noinst_HEADERS = \
 	bitops.h \
diff -Naur util-linux-ng-2.15.orig/lib/Makefile.in util-linux-ng-2.15/lib/Makefile.in
--- util-linux-ng-2.15.orig/lib/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/lib/Makefile.in	2009-05-17 17:51:59.000000000 +0000
@@ -46,8 +46,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -248,6 +248,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 test_blkdev_SOURCES = blkdev.c $(am__append_1)
 test_ismounted_SOURCES = ismounted.c
diff -Naur util-linux-ng-2.15.orig/lib/fsprobe.c util-linux-ng-2.15/lib/fsprobe.c
--- util-linux-ng-2.15.orig/lib/fsprobe.c	2009-05-05 19:16:46.000000000 +0000
+++ util-linux-ng-2.15/lib/fsprobe.c	2009-05-17 17:51:39.000000000 +0000
@@ -7,7 +7,11 @@
 #include <sys/types.h>
 #include <stdlib.h>
 
+#ifdef HAVE_BLKID_BLKID_H
+#include <blkid/blkid.h>
+#else
 #include <blkid.h>
+#endif
 
 #include "blkdev.h"
 #include "canonicalize.h"
diff -Naur util-linux-ng-2.15.orig/libs/Makefile.in util-linux-ng-2.15/libs/Makefile.in
--- util-linux-ng-2.15.orig/libs/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/libs/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -41,8 +41,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
diff -Naur util-linux-ng-2.15.orig/libs/blkid/Makefile.in util-linux-ng-2.15/libs/blkid/Makefile.in
--- util-linux-ng-2.15.orig/libs/blkid/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -44,8 +44,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -237,6 +237,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 SUBDIRS = src bin
 
diff -Naur util-linux-ng-2.15.orig/libs/blkid/bin/Makefile.in util-linux-ng-2.15/libs/blkid/bin/Makefile.in
--- util-linux-ng-2.15.orig/libs/blkid/bin/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/bin/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -46,8 +46,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -251,6 +251,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = blkid.8 findfs.8
 @HAVE_STATIC_BLKID_TRUE@blkid_static_SOURCES = $(blkid_SOURCES)
diff -Naur util-linux-ng-2.15.orig/libs/blkid/src/Makefile.in util-linux-ng-2.15/libs/blkid/src/Makefile.in
--- util-linux-ng-2.15.orig/libs/blkid/src/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/src/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -46,8 +46,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -263,6 +263,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 SUBDIRS = probers .
 common_ldadd = $(am__append_1)
diff -Naur util-linux-ng-2.15.orig/libs/blkid/src/config.c util-linux-ng-2.15/libs/blkid/src/config.c
--- util-linux-ng-2.15.orig/libs/blkid/src/config.c	2009-04-20 09:47:46.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/src/config.c	2009-05-17 17:51:39.000000000 +0000
@@ -24,9 +24,6 @@
 #include <errno.h>
 #endif
 #include <stdint.h>
-#ifdef HAVE_LIBUUID
-#include <uuid/uuid.h>
-#endif
 #include <stdarg.h>
 
 #include "blkdev.h"
diff -Naur util-linux-ng-2.15.orig/libs/blkid/src/evaluate.c util-linux-ng-2.15/libs/blkid/src/evaluate.c
--- util-linux-ng-2.15.orig/libs/blkid/src/evaluate.c	2009-05-05 19:16:46.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/src/evaluate.c	2009-05-17 17:51:39.000000000 +0000
@@ -27,9 +27,6 @@
 #include <errno.h>
 #endif
 #include <stdint.h>
-#ifdef HAVE_LIBUUID
-#include <uuid/uuid.h>
-#endif
 #include <stdarg.h>
 
 #include "pathnames.h"
diff -Naur util-linux-ng-2.15.orig/libs/blkid/src/probers/Makefile.in util-linux-ng-2.15/libs/blkid/src/probers/Makefile.in
--- util-linux-ng-2.15.orig/libs/blkid/src/probers/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/src/probers/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -43,8 +43,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -237,6 +237,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 noinst_LTLIBRARIES = libblkid_probers.la
 libblkid_probers_la_SOURCES = \
diff -Naur util-linux-ng-2.15.orig/libs/blkid/src/read.c util-linux-ng-2.15/libs/blkid/src/read.c
--- util-linux-ng-2.15.orig/libs/blkid/src/read.c	2009-04-20 09:48:57.000000000 +0000
+++ util-linux-ng-2.15/libs/blkid/src/read.c	2009-05-17 17:51:39.000000000 +0000
@@ -25,7 +25,6 @@
 #endif
 
 #include "blkidP.h"
-#include "uuid/uuid.h"
 
 #ifdef HAVE_STRTOULL
 #define STRTOULL strtoull /* defined in stdlib.h if you try hard enough */
diff -Naur util-linux-ng-2.15.orig/login-utils/Makefile.in util-linux-ng-2.15/login-utils/Makefile.in
--- util-linux-ng-2.15.orig/login-utils/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/login-utils/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -80,8 +80,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -383,6 +383,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = $(am__append_2) $(am__append_4) $(am__append_6) \
 	$(am__append_10) $(am__append_26) $(am__append_28)
diff -Naur util-linux-ng-2.15.orig/m4/pkg.m4 util-linux-ng-2.15/m4/pkg.m4
--- util-linux-ng-2.15.orig/m4/pkg.m4	1970-01-01 00:00:00.000000000 +0000
+++ util-linux-ng-2.15/m4/pkg.m4	2007-06-20 10:43:08.000000000 +0000
@@ -0,0 +1,157 @@
+# pkg.m4 - Macros to locate and utilise pkg-config.            -*- Autoconf -*-
+# 
+# Copyright Â© 2004 Scott James Remnant <scott@netsplit.com>.
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+#
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that program.
+
+# PKG_PROG_PKG_CONFIG([MIN-VERSION])
+# ----------------------------------
+AC_DEFUN([PKG_PROG_PKG_CONFIG],
+[m4_pattern_forbid([^_?PKG_[A-Z_]+$])
+m4_pattern_allow([^PKG_CONFIG(_PATH)?$])
+AC_ARG_VAR([PKG_CONFIG], [path to pkg-config utility])dnl
+if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
+	AC_PATH_TOOL([PKG_CONFIG], [pkg-config])
+fi
+if test -n "$PKG_CONFIG"; then
+	_pkg_min_version=m4_default([$1], [0.9.0])
+	AC_MSG_CHECKING([pkg-config is at least version $_pkg_min_version])
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
+		AC_MSG_RESULT([yes])
+	else
+		AC_MSG_RESULT([no])
+		PKG_CONFIG=""
+	fi
+		
+fi[]dnl
+])# PKG_PROG_PKG_CONFIG
+
+# PKG_CHECK_EXISTS(MODULES, [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
+#
+# Check to see whether a particular set of modules exists.  Similar
+# to PKG_CHECK_MODULES(), but does not set variables or print errors.
+#
+#
+# Similar to PKG_CHECK_MODULES, make sure that the first instance of
+# this or PKG_CHECK_MODULES is called, or make sure to call
+# PKG_CHECK_EXISTS manually
+# --------------------------------------------------------------
+AC_DEFUN([PKG_CHECK_EXISTS],
+[AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
+if test -n "$PKG_CONFIG" && \
+    AC_RUN_LOG([$PKG_CONFIG --exists --print-errors "$1"]); then
+  m4_ifval([$2], [$2], [:])
+m4_ifvaln([$3], [else
+  $3])dnl
+fi])
+
+
+# _PKG_CONFIG([VARIABLE], [COMMAND], [MODULES])
+# ---------------------------------------------
+m4_define([_PKG_CONFIG],
+[if test -n "$PKG_CONFIG"; then
+    if test -n "$$1"; then
+        pkg_cv_[]$1="$$1"
+    else
+        PKG_CHECK_EXISTS([$3],
+                         [pkg_cv_[]$1=`$PKG_CONFIG --[]$2 "$3" 2>/dev/null`],
+			 [pkg_failed=yes])
+    fi
+else
+	pkg_failed=untried
+fi[]dnl
+])# _PKG_CONFIG
+
+# _PKG_SHORT_ERRORS_SUPPORTED
+# -----------------------------
+AC_DEFUN([_PKG_SHORT_ERRORS_SUPPORTED],
+[AC_REQUIRE([PKG_PROG_PKG_CONFIG])
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi[]dnl
+])# _PKG_SHORT_ERRORS_SUPPORTED
+
+
+# PKG_CHECK_MODULES(VARIABLE-PREFIX, MODULES, [ACTION-IF-FOUND],
+# [ACTION-IF-NOT-FOUND])
+#
+#
+# Note that if there is a possibility the first call to
+# PKG_CHECK_MODULES might not happen, you should be sure to include an
+# explicit call to PKG_PROG_PKG_CONFIG in your configure.ac
+#
+#
+# --------------------------------------------------------------
+AC_DEFUN([PKG_CHECK_MODULES],
+[AC_REQUIRE([PKG_PROG_PKG_CONFIG])dnl
+AC_ARG_VAR([$1][_CFLAGS], [C compiler flags for $1, overriding pkg-config])dnl
+AC_ARG_VAR([$1][_LIBS], [linker flags for $1, overriding pkg-config])dnl
+
+pkg_failed=no
+AC_MSG_CHECKING([for $1])
+
+_PKG_CONFIG([$1][_CFLAGS], [cflags], [$2])
+_PKG_CONFIG([$1][_LIBS], [libs], [$2])
+
+m4_define([_PKG_TEXT], [Alternatively, you may set the environment variables $1[]_CFLAGS
+and $1[]_LIBS to avoid the need to call pkg-config.
+See the pkg-config man page for more details.])
+
+if test $pkg_failed = yes; then
+        _PKG_SHORT_ERRORS_SUPPORTED
+        if test $_pkg_short_errors_supported = yes; then
+	        $1[]_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "$2"`
+        else 
+	        $1[]_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "$2"`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$$1[]_PKG_ERRORS" >&AS_MESSAGE_LOG_FD
+
+	ifelse([$4], , [AC_MSG_ERROR(dnl
+[Package requirements ($2) were not met:
+
+$$1_PKG_ERRORS
+
+Consider adjusting the PKG_CONFIG_PATH environment variable if you
+installed software in a non-standard prefix.
+
+_PKG_TEXT
+])],
+		[AC_MSG_RESULT([no])
+                $4])
+elif test $pkg_failed = untried; then
+	ifelse([$4], , [AC_MSG_FAILURE(dnl
+[The pkg-config script could not be found or is too old.  Make sure it
+is in your PATH or set the PKG_CONFIG environment variable to the full
+path to pkg-config.
+
+_PKG_TEXT
+
+To get pkg-config, see <http://pkg-config.freedesktop.org/>.])],
+		[$4])
+else
+	$1[]_CFLAGS=$pkg_cv_[]$1[]_CFLAGS
+	$1[]_LIBS=$pkg_cv_[]$1[]_LIBS
+        AC_MSG_RESULT([yes])
+	ifelse([$3], , :, [$3])
+fi[]dnl
+])# PKG_CHECK_MODULES
diff -Naur util-linux-ng-2.15.orig/misc-utils/Makefile.in util-linux-ng-2.15/misc-utils/Makefile.in
--- util-linux-ng-2.15.orig/misc-utils/Makefile.in	2009-05-05 21:21:34.000000000 +0000
+++ util-linux-ng-2.15/misc-utils/Makefile.in	2009-05-17 17:52:00.000000000 +0000
@@ -61,8 +61,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -312,6 +312,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 EXTRA_DIST = README.flushb README.cal README.ddate README.namei \
 	README.namei2 README.reset reset.033c
diff -Naur util-linux-ng-2.15.orig/mount/Makefile.in util-linux-ng-2.15/mount/Makefile.in
--- util-linux-ng-2.15.orig/mount/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/mount/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -63,8 +63,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -386,6 +386,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 EXTRA_DIST = README.mount
 dist_man_MANS = fstab.5 mount.8 swapoff.8 swapon.8 umount.8 losetup.8
diff -Naur util-linux-ng-2.15.orig/partx/Makefile.in util-linux-ng-2.15/partx/Makefile.in
--- util-linux-ng-2.15.orig/partx/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/partx/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -47,8 +47,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -255,6 +255,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 @BUILD_PARTX_TRUE@partx_SOURCES = bsd.c dos.c partx.c solaris.c \
 @BUILD_PARTX_TRUE@	unixware.c gpt.c crc32.c efi.h gpt.h crc32.h \
diff -Naur util-linux-ng-2.15.orig/schedutils/Makefile.in util-linux-ng-2.15/schedutils/Makefile.in
--- util-linux-ng-2.15.orig/schedutils/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/schedutils/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -50,8 +50,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -252,6 +252,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 @BUILD_SCHEDUTILS_TRUE@dist_man_MANS = chrt.1 $(am__append_2) \
 @BUILD_SCHEDUTILS_TRUE@	$(am__append_4)
diff -Naur util-linux-ng-2.15.orig/sys-utils/Makefile.in util-linux-ng-2.15/sys-utils/Makefile.in
--- util-linux-ng-2.15.orig/sys-utils/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/sys-utils/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -72,8 +72,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -362,6 +362,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 dist_man_MANS = flock.1 ipcrm.1 ipcs.1 ipcmk.1 renice.1 setsid.1 \
 	readprofile.1 $(am__append_5) $(am__append_7) $(am__append_9) \
diff -Naur util-linux-ng-2.15.orig/tests/Makefile.in util-linux-ng-2.15/tests/Makefile.in
--- util-linux-ng-2.15.orig/tests/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/tests/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -43,8 +43,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -225,6 +225,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 SUBDIRS = helpers
 EXTRA_DIST = expected \
diff -Naur util-linux-ng-2.15.orig/tests/helpers/Makefile.in util-linux-ng-2.15/tests/helpers/Makefile.in
--- util-linux-ng-2.15.orig/tests/helpers/Makefile.in	2009-05-05 21:21:35.000000000 +0000
+++ util-linux-ng-2.15/tests/helpers/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -45,8 +45,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -244,6 +244,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 test_md5_SOURCES = test_md5.c $(top_srcdir)/lib/md5.c
 all: all-am
diff -Naur util-linux-ng-2.15.orig/text-utils/Makefile.in util-linux-ng-2.15/text-utils/Makefile.in
--- util-linux-ng-2.15.orig/text-utils/Makefile.in	2009-05-05 21:21:36.000000000 +0000
+++ util-linux-ng-2.15/text-utils/Makefile.in	2009-05-17 17:52:01.000000000 +0000
@@ -52,8 +52,8 @@
 	$(top_srcdir)/m4/libtool.m4 $(top_srcdir)/m4/ltoptions.m4 \
 	$(top_srcdir)/m4/ltsugar.m4 $(top_srcdir)/m4/ltversion.m4 \
 	$(top_srcdir)/m4/lt~obsolete.m4 $(top_srcdir)/m4/nls.m4 \
-	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
-	$(top_srcdir)/configure.ac
+	$(top_srcdir)/m4/pkg.m4 $(top_srcdir)/m4/po.m4 \
+	$(top_srcdir)/m4/progtest.m4 $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
@@ -284,6 +284,7 @@
 # Paths to in-tree libraries (use ul_ prefix to avoid possible collisions)
 #
 ul_libblkid_srcdir = $(top_srcdir)/libs/blkid/src
+ul_libblkid_builddir = $(top_builddir)/libs/blkid/src
 ul_libblkid_la = $(top_builddir)/libs/blkid/src/libblkid.la
 EXTRA_DIST = README.clear README.col README.pg LICENSE.pg
 hexdump_SOURCES = hexdump.c conv.c display.c hexsyntax.c odsyntax.c parse.c \
